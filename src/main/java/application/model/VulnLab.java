package application.model;

import javafx.beans.property.SimpleStringProperty;
import lombok.Data;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;

import java.util.ArrayList;
import java.util.List;

@Data
public class VulnLab {
    private SimpleStringProperty date;
    private SimpleStringProperty name;
    private SimpleStringProperty type;

    private String URL;
    private List<VulnLab> vulnLab = new ArrayList<>();


    public VulnLab(String date, String name, String type) {
        this.date = new SimpleStringProperty(date);
        this.name = new SimpleStringProperty(name);
        this.type = new SimpleStringProperty(type);
    }

    public VulnLab() {
    }

    public List<VulnLab> vulnLabScrape(String vuln) {
        URL = "https://www.vulnerability-lab.com/search.php?search=" + vuln + "&submit=Search";
        try {
            int i = 0;
            final Document document = Jsoup.connect(URL).get();
            String date = null;
            String name = null;
            String type;

            for (Element row : document.select(".topbar tr td tr td")) {
                if (row.select("td:nth-of-type(2)").text().equals("Date") ||
                        row.select("td:nth-of-type(4)").text().equals("Advisory Name") ||
                        row.select("td:nth-of-type(6)").text().equals("Type")) {
                    continue;
                } else {

                    String test1 = row.select("td:nth-of-type(2)").text();
                    String test2 = row.select("td:nth-of-type(4)").text();
                    String test3 = row.select("td:nth-of-type(6)").text();
                    if (!test1.isEmpty()) {
                        date = row.select("td:nth-of-type(2)").text();
                    }
                    if (!test2.isEmpty()) {
                        name = row.select("td:nth-of-type(4)").text();
                    }
                    if (!test3.isEmpty()) {
                        type = row.select("td:nth-of-type(6)").text();
                        vulnLab.add(new VulnLab(date, name, type));
                        i++;
                    }
                    if (i == 10) break;
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return vulnLab;
    }

    public String getDate() {
        return date.get();
    }

    public void setDate(String date) {
        this.date.set(date);
    }

    public SimpleStringProperty dateProperty() {
        return this.date;
    }

    public String getName() {
        return name.get();
    }

    public void setName(String name) {
        this.name.set(name);
    }

    public SimpleStringProperty nameProperty() {
        return this.name;
    }

    public String getType() {
        return type.get();
    }

    public void setType(String type) {
        this.type.set(type);
    }

    public SimpleStringProperty typeProperty() {
        return this.type;
    }
}
