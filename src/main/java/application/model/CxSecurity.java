package application.model;

import javafx.beans.property.SimpleStringProperty;
import lombok.Data;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;

import java.util.ArrayList;
import java.util.List;

@Data
public class CxSecurity {
    private SimpleStringProperty severity;
    private SimpleStringProperty topic;
    private SimpleStringProperty date;

    private String URL;
    private List<CxSecurity> cxSecurtitys = new ArrayList<>();


    public CxSecurity(String severity, String topic, String date) {
        this.severity = new SimpleStringProperty(severity);
        this.topic = new SimpleStringProperty(topic);
        this.date = new SimpleStringProperty(date);
    }

    public CxSecurity() {
    }

    public List<CxSecurity> cxSecurityScrape(String vuln) {
        URL = "https://cxsecurity.com/search/wlb/DESC/AND/2025.5.10.1999.1.1/0/10/" + vuln + "/";
        try {
            final Document document = Jsoup.connect(URL).get();
            for (Element row : document.select("table tr")) {
                if (!row.select("td:nth-of-type(1)").text().equals("High")
                && !row.select("td:nth-of-type(1)").text().equals("Med.")
                && !row.select("td:nth-of-type(1)").text().equals("Low")) {
                    continue;
                }
                final String severity = row.select("td:nth-of-type(1)").text();
                final String topic = row.select("td:nth-of-type(2)").text();
                final String date = row.select("td:nth-of-type(3)").text();
                cxSecurtitys.add(new CxSecurity(severity, topic, date));
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return cxSecurtitys;
    }

    public String getSeverity() {
        return severity.get();
    }

    public void setSeverity(String severity) {
        this.severity.set(severity);
    }

    public SimpleStringProperty severityProperty() {
        return this.severity;
    }

    public String getTopic() {
        return topic.get();
    }

    public void setTopic(String topic) {
        this.topic.set(topic);
    }

    public SimpleStringProperty topicProperty() {
        return this.topic;
    }

    public String getDate() {
        return date.get();
    }

    public void setDate(String date) {
        this.date.set(date);
    }

    public SimpleStringProperty dateProperty() {
        return this.date;
    }
}
